---
layout: solution
codename: ovens
---

## Επεξήγηση εκφώνησης 

Μας δίνονται $$N$$ φούρνοι με την αρχική τους κατάσταση (αναμμένος ή σβηστός) και $$N$$ διακόπτες έναν για κάθε φούρνο $$i$$ ο οποίος αλλάζει την κατάσταση των φούρνων από τον $$i$$-οστό έως και τον $$i + k_i$$. 


## Λύση με ταξινόμηση

**Παρατήρηση 0:** Δεν μας συμφέρει να χρησιμοποιήσουμε έναν διακόπτη πάνω από μία φορές. 

**Παρατήρηση 1η:** Έχοντας αποφασίσει ποιους διακόπτες θα πατήσουμε από το $$1$$ έως το $$i$$, πρέπει να πατήσουμε τον διακόπτη $$i+1$$ αν και μόνο αν ο $$i$$-οστός φούρνος είναι αναμμένος εκείνη την στιγμή.

Χρησιμοποιώντας αυτή την παρατήρηση, ξεκινάμε με τον πρώτο διακόπτη και αν ο φούρνος είναι αναμμένος, τότε πρέπει να τον σβήσουμε. Καθώς σβήνουμε τον $$i$$-οστό φούρνο, ανανεώνουμε και την κατάσταση των φούρνων στις θέσεις $$i + 1$$ έως $$i + k_i$$.

{% include code.md solution_name='ovens_brute_force.cc'  %}

Ο αλγόριθμος αυτός χρειάζεται $$O(\sum_{i=1}^n (1+k_i))$$ χρόνο που στην χειρότερη περίπτωση μπορεί να είναι $$O(n^2)$$.

## Βέλτιστη λύση (100%)

Κρατώντας σε κάθε στιγμή το πλήθος των διακοπτών που επηρεάζουν τον τωρινό διακόπτη, ξέρουμε την κατάστασή του ($$a_i$$ αν είναι ζυγός ή $$1-a_i$$ αν είναι μονός). Κρατάμε επίσης `switch_ending[j]` το πλήθος των διακοπτών που τελειώνει στην θέση $$j$$ (για την ακρίβεια, από την Παρατήρηση 0, μπορούμε να κρατήσουμε μόνο το πλήθος mod 2). 

Αυτό που αλλάζει είναι ότι 
- η κατάσταση μίας λάμπας είναι $$a_i \oplus \texttt{cur}$$,
- στο τέλος κάθε βήματος $$\texttt{cur} = \texttt{cur} \oplus \texttt{switch\_ending}[j]$$, και
- όταν πατήσουμε έναν διακόπτη, τότε βάζουμε $$\texttt{switch\_ending}[j] = !\texttt{switch\_ending}[j]$$ (δηλαδή ενημερώνουμε ότι ένας διακόπτης τελειώνει στο συγκεκριμκένο βήμα.

{% include code.md solution_name='ovens_efficient.cc'  %}

Η λύση αυτή χρειάζεται $$O(N)$$ χρόνο και περνάει όλα τα testcases.

## Λύσεις για συγκεκριμένα υποπροβλήματα

Τα υποπροβλήματα μπορούν να λυθούν ως εξής:
 - **Υποπρόβλημα 1 $$k_i = 0$$:** Κάθε διακόπτης επηρεάζει μόνο την αντίστοιχη λάμπα, επομένως πρέπει να σβήσουμε τόσους διακόπτες όσες και αναμμένες λάμπες.
 - **Υποπρόβλημα 2 $$a_i = 1$$:** .
 - **Υποπρόβλημα 3 $$k_i \leq 10$$:** Μπορούμε να κάνουμε δυναμικό προγραμματισμό κρατώντας ποιοι από τους τελευταίους $$k_i$$ έχουν ανάψει. Καθώς το $$k_i$$ είναι μικρό μπορούμε να κρατάμε όλες τις καταστάσεις των τελευταίων $$k_i$$  διακοπτών. 
 - **Υποπρόβλημα 4 $$k_i = N - i$$:** Μπορούμε να εφαρμόσουμε την παραπάνω λύση κρατώντας μόνο το πλήθος των ενεργών διακοπτών, καθώς όλοι λήγουν στο τέλος.
