---
layout: solution
codename: ovens
---

## Επεξήγηση εκφώνησης 

Μας δίνονται $$N$$ φούρνοι με την αρχική τους κατάσταση (αναμμένος ή σβηστός) και $$N$$ διακόπτες ένας για κάθε φούρνο $$i$$ ο οποίος όταν πατηθεί αλλάζει την κατάσταση των φούρνων από τον $$i$$-οστό έως και τον $$i + k_i$$. 


## Λύση από τα αριστερά προς τα δεξιά (32%)

**Παρατήρηση 0:** Αν αναβοσβήσουμε έναν φούρνο *ζυγό* αριθμό φορών τότε η κατάστασή του είναι η ίδια με την αρχική. Αν τον αναβοσβήσουμε *μονό*, τότε είναι η αντίθετη. 

**Παρατήρηση 1η:** Δεν μας συμφέρει να πατήσουμε έναν διακόπτη πάνω από μία φορά, καθώς απλά αναβοσβήνουμε τους ίδιους φούρνους.

**Παρατήρηση 2η:** Έχοντας αποφασίσει ποιους από τους πρώτους $$i-1$$ διακόπτες θα πατήσουμε, πρέπει να πατήσουμε τον διακόπτη $$i$$ αν και μόνο αν ο $$i$$-οστός φούρνος είναι αναμμένος εκείνη την στιγμή. (Διαφορετικά, δεν θα έχουμε άλλη ευκαιρία να τον σβήσουμε)

Χρησιμοποιώντας αυτή την παρατήρηση, ξεκινάμε με τον πρώτο διακόπτη και αν ο φούρνος είναι αναμμένος, τότε πρέπει να τον σβήσουμε. Παρόμοια συνεχίζουμε για τους φούρνους $$2, 3, \ldots$$. Καθώς σβήνουμε τον $$i$$-οστό φούρνο, ανανεώνουμε και την κατάσταση των φούρνων στις θέσεις $$i + 1$$ έως και $$i + k_i$$. Για κάθε ανανέωση πρέπει να αλλάξουμε την κατάσταση $$k_i+1$$ φούρνων. Επομένως, ο αλγόριθμος αυτός χρειάζεται $$O(\sum_{i=1}^n (k_i+1))$$ χρόνο που στην χειρότερη περίπτωση μπορεί να είναι $$\Omega(n^2)$$. 

Αυτό είναι αρκετό για να περάσει περίπου το 32% των βαθμών (τα υποπροβλήματα 1 και 3).

{% include code.md solution_name='ovens_sub_3.cc'  %}

**Σημείωση:** Με μερικές μικρές τροποποιήσεις, η λύση μπορεί να περάσει και τα υποπροβλήματα 2 και 4 (δείτε παρακάτω).

## Βέλτιστη λύση (100%)

Σε αυτή την λύση θα προσπαθήσουμε να κάνουμε την ανανέωση των $$k_i$$ φούρνων πιο αποδοτικά. 

Κρατώντας σε κάθε στιγμή το πλήθος `active_switch_mod_2` των διακοπτών στα αριστερά που επηρεάζουν τον $$i$$-οστό φούρνο, ξέρουμε την κατάστασή του (`a[i]` αν `active_switch_mod_2` είναι ζυγός ή `!a[i]` αν είναι μονός). Κρατάμε επίσης `switch_ending[j]` το πλήθος των διακοπτών που τελειώνουν στην θέση `j`. Από την Παρατήρηση 0, και για τις δύο μεταβλητές μπορούμε να κρατήσουμε μόνο το υπόλοιπό τους με τον αριθμό 2. 

Στο $$i$$-οστό βήμα: 
- η κατάσταση ενός φούρνου είναι $$a_i \oplus \texttt{active\_switch\_mod\_2}$$ (όπου $$\oplus$$ είναι η [αποκλειστική διάζευξη (xor)](https://el.wikipedia.org/wiki/%CE%91%CF%80%CE%BF%CE%BA%CE%BB%CE%B5%CE%B9%CF%83%CF%84%CE%B9%CE%BA%CE%AE_%CE%B4%CE%B9%CE%AC%CE%B6%CE%B5%CF%85%CE%BE%CE%B7)),
- αν ο φούρνος ήταν αναμμένος, τότε 
  - αυξάνουμε το πλήθος των τωρινών πατημένων διακοπτών, ``active_switch_mod_2 = !active_switch_mod_2`` και 
  - ενημερώνουμε ότι ένας ακόμα διακόπτης τελειώνει στο βήμα ``j = i + k[i]``, δηλαδή 
    ``switch_ending[j] = !switch_ending[j]``, και επίσης
- στο τέλος κάθε βήματος $$\texttt{active\_switch\_mod\_2} = \texttt{active\_switch\_mod\_2} \oplus \texttt{switch\_ending}[\texttt{i}]$$.

Άρα κάθε ανανέωση γίνεται σε $$O(1)$$ χρόνο και επομένως η λύση αυτή χρειάζεται $$O(N)$$ χρόνο συνολικά, και περνάει όλα τα testcases.

{% include code.md solution_name='ovens_efficient.cc'  %}



## Λύσεις για συγκεκριμένα υποπροβλήματα

Τα υποπροβλήματα μπορούν να λυθούν ως εξής:
 - **Υποπρόβλημα 1 $$k_i = 0$$:** Κάθε διακόπτης επηρεάζει μόνο τον αντίστοιχο φούρνο, επομένως πρέπει να σβήσουμε τόσους διακόπτες όσοι είναι και οι αναμμένοι φούρνοι  ([κώδικας]({% include link_to_source.md solution_name='oven_sub1.cc' %})).
 - **Υποπρόβλημα 2 $$a_i = 1$$:** Επεκτείνουμε την πρώτη λύση ως εξής: Όταν είμαστε στον $$i$$-οστό φούρνο μπορούμε απλά να προσπεράσουμε τους επόμενους $$k[i]$$ καθώς θα σβήσουν όταν πατήσουμε τον διακόπτη του $$i$$-οστού ([κώδικας]({% include link_to_source.md solution_name='oven_sub2.cc' %})). 
 - **Υποπρόβλημα 3 $$k_i \leq 10$$:** Μπορούμε να εφαρμόσουμε αυτούσια την πρώτη λύση.
 - **Υποπρόβλημα 4 $$k_i = N - i$$:** Επεκτείνουμε την πρώτη λύση ως εξής: Κρατάμε μόνο το πλήθος των ενεργών διακοπτών mod 2 (δηλαδή το ``active_switch_mod_2`` της βέλτιστης λύσης), καθώς ξέρουμε ότι όλοι λήγουν στο τέλος ([κώδικας]({% include link_to_source.md solution_name='oven_sub4.cc' %})).
