---
layout: solution
codename: crazyhotel
---

## Επεξήγηση εκφώνησης

Μας δίνεται πίνακας $$A$$ με $$N$$ μη αρνητικές τιμές $$A_i$$ (το κόστος διαμονής της ημέρας $$i$$) και δύο τιμές ακόμα, το μέγιστο επιτρεπτό άθροισμα $$S$$ και η μέγιστη επιτρεπτή τιμή $$T$$. 
Ζητείται να βρούμε πόσοι είναι οι συνδυασμοί συνεχόμενων αριθμών με άθροισμα που δεν ξεπερνά το $$S$$ και καμία τους τιμή δεν ξεπερνά το $$T$$.

**Παρατήρηση 1:** Έστω ότι έχουμε $$k$$ συνεχόμενους αριθμούς $$A_i,A_{i+1},A_{i+2},\dots,A_{i+k-1}$$ που το άθροισμα τους δεν ξεπερνά το $$S$$ και κανένας εξ' αυτών δεν έχει τιμή που να ξεπερνά το $$T$$. 
Αυτοί οι $$k$$ αριθμοί, δίνουν $$k$$ δυνατά διαστήματα συνεχόμενων αριθμών που να περιλαμβάνουν το $$A_i$$. Αυτοί οι συνδυασμοί είναι:  
$$A_i$$  
$$A_i + A_{i+1}$$  
$$A_i + A_{i+1} + A_{i+2}$$  
$$A_i + A_{i+1} + A_{i+2} + A_{i+3}$$  
$$\vdots$$  
$$A_i + A_{i+1} + A_{i+2} + A_{i+3} + \dots + A_{i+k-1}$$  

Οπότε αρκεί σε κάθε θέση $$\mathit{left}$$, με $$1 \le \mathit{left} \le N$$, να βρεθεί η μεγαλύτερη θέση $$\mathit{right}$$ ($$\mathit{left}
\le \mathit{right} \le N$$), ώστε το άθροισμα όλων των στοιχείων $$A_\mathit{left} + A_{\mathit{left}+1} + \dots + A_{\mathit{right}-1} + A_{\mathit{right}} \le S$$ 
και κανένας από αυτούς τους αριθμούς να μην υπερβαίνει το $$T$$.

**Παρατήρηση 2:** Το διάστημα $$A_\mathit{left}$$ έως και $$A_\mathit{right}$$, περιλαμβάνει $$\mathit{right}-\mathit{left}+1$$ στοιχεία.


## Μη αποδοτική λύση brute force. Πολυπλοκότητα $$\mathcal{O}(N^2)$$.

Για κάθε θέση $$\mathit{left}$$ εκτελούμε ένα βρόγχο *while* ώστε να βρούμε τη θέση $$\mathit{right}$$. Αθροίζουμε τα μήκη όλων των
διαστημάτων $$[\mathit{left},\mathit{right}]$$ που ικανοποιούν τους περιορισμούς των $$S$$ και $$T$$.

{% include code.md solution_name='crazyhotel_brute.cpp' %}

## Βέλτιστη λύση με χρήση δύο δεικτών (two pointers). Πολυπλοκότητα $$\mathcal{O}(N)$$.

Η τεχνική αυτή χρησιμοποιεί τους δύο pointers $$\mathit{left}, \mathit{right}$$ για να βρει όλα τα διαστήματα που μας ενδιαφέρουν στον πίνακα. 

Στην προηγούμενη λύση, η θέση $$\mathit{left}$$ αυξάνεται κατά $$1$$ σε κάθε επανάληψη του εξωτερικού *for* μέχρι να προσπελάσει ολόκληρο τον πίνακα. 
Η θέση $$\mathit{right}$$ αντιστοιχεί στη μεγαλύτερη θέση του πίνακα όπου $$A_\mathit{left}+A_{\mathit{left}+1}+A_{\mathit{left}+2}+\dots+A_\mathit{right} \leq S$$ και
κανένα στοιχείο του διαστήματος δεν υπερβαίνει το $$T$$. 

Στην επόμενη επανάληψη του εξωτερικού *for*, το $$[\mathit{left},\mathit{right}]$$ θα συρρικνωθεί από αριστερά, στο $$[\mathit{left}+1,\mathit{right}]$$ και καθώς το
$$A_\mathit{left}$$ που έφυγε από το επιλεγμένο διάστημα, ήταν μη αρνητικός αριθμός, το άθροισμα του συρρικνωμένου διαστήματος δεν θα μεγαλώσει.
Καθώς το $$\mathit{left}$$ μετακινείται προς τα δεξιά, το $$\mathit{right}$$ θα μετακινείτε και αυτό προς τα δεξιά, όσο και αν χρειαστεί,
ώστε να βρούμε τη νέα μέγιστη θέση και να συνεχίσουν να ισχύουν οι περιορισμοί των $$S$$ και $$T$$.

Συνολικά θα μετακινήσουμε κάθε δείκτη $$N$$ βήματα, οπότε η πολυπλοκότητα είναι $$\mathcal{O}(N)$$.

Για τον υπολογισμό του αθροίσματος κάθε διαστήματος $$[\mathit{left},\mathit{right}]$$ μπορούν να χρησιμοποιηθούν τα prefix sums (ή cumulative sums) όπως στον παρακάτω κώδικα:

{% include code.md solution_name='crazyhotel_sliding_ps.cpp' start=10 end=23 %}
(δείτε τον πλήρη κώδικα [εδώ]({% include link_to_source.md solution_name='crazyhotel_sliding_ps.cpp' %}))

ή το άθροισμα να υπολογίζεται δυναμικά (on the fly):

{% include code.md solution_name='crazyhotel_sliding_v2.cpp' start=13 end=26 %}
(δείτε τον πλήρη κώδικα [εδώ]({% include link_to_source.md solution_name='crazyhotel_sliding_v2.cpp' %}))

Υπάρχει μια λύση ακόμα, όπου οι δύο δείκτες δεν αναφέρονται σε πίνακα στη μνήμη, αλλά στον αποθηκευμένο στο αρχείο πίνακα. Η λύση αυτή αν και λιγότερο αποδοτική, χρειάζεται μνήμη $$\mathcal{O}(1)$$ καθώς δεν δεσμεύει μνήμη για τον πίνακα $$A$$. Θα χρειαστεί να δημιουργήσουμε ένα αντίγραφο του χειριστή αρχείου για να χρησιμοποιεί ο δεύτερος δείκτης (π.χ. με τη συνάρτηση dup) ή να ανοίξουμε το αρχείο δύο φορές.

{% include code.md solution_name='crazyhotel_sliding_constmem.cpp' start=15 end=32 %}
(δείτε τον πλήρη κώδικα [εδώ]({% include link_to_source.md solution_name='crazyhotel_sliding_constmem.cpp' %}))

## Λύση με δυαδική αναζήτηση. Πολυπλοκότητα $$\mathcal{O}(N\dot \log {N} )$$.

Καθώς οι τιμές του πίνακα είναι μη αρνητικές, ο πίνακας των prefix sum έχει αύξουσα διάταξη. Χρησιμοποιώντας το prefix sum μπορούμε να βρούμε ξεκινώντας από μια θέση $$\mathit{left}$$ τη μεγαλύτερη θέση $$\mathit{right}$$, όπου το prefix sum δεν θα αυξηθεί περισσότερο από $$S$$. Μένει να αποφύγουμε τις απαγορευτικές τιμές που ξεπερνούν το $$T$$. 

Μια λύση είναι να διαβάζονται οι τιμές $$A_i$$ από το αρχείο εισόδου μέχρι να φτάσουμε σε απαγορευτική τιμή ή στο τέλος του πίνακα. Κάνουμε τους υπολογισμούς στο διάστημα που προηγήθηκε και κατόπιν επαναλαμβάνουμε μέχρι να εξαντληθούν οι $$N$$ τιμές. Ο κώδικας ακολουθεί:

{% include code.md solution_name='crazyhotel_nlogn.cpp' start=8 end=29 %}
(δείτε τον πλήρη κώδικα [εδώ]({% include link_to_source.md solution_name='crazyhotel_nlogn.cpp' %}))

Μια άλλη λύση για το binary search που να ξεπερνά το εμπόδιο των απαγορευτικών τιμών, είναι να αυξηθεί η τιμή των ημερών αυτών σε $$S+1$$. 
Με τον τρόπο αυτό, η prefix sum που ψάχνει τη μεγαλύτερη αύξηση από τη θέση $$\mathit{left}$$ που όμως να μην ξεπερνά το $$S$$, δεν θα συμπεριλάβει ποτέ τέτοιο σημείο. 
Προσοχή στην υλοποίηση αυτή χρειάζεται ο τύπος ακεραίων που θα χρησιμοποιηθεί στον πίνακα prefix sum. Εφόσον ενδέχεται να έχουμε έως $$N=1.000.000$$ απαγορευτικές τιμές 
και με μέγιστο $$S=1.000.000.000$$, το prefix sum θα πρέπει να χωρά τον αριθμό $$10^6\cdot (10^9+1)$$, άρα θα χρειαστούμε ακεραίους 64bit.

{% include code.md solution_name='crazyhotel_nlogn_v2.cpp' start=18 end=37 %}
(δείτε τον πλήρη κώδικα [εδώ]({% include link_to_source.md solution_name='crazyhotel_nlogn_v2.cpp' %}))


