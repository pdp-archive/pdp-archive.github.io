---
layout: solution
codename: wayhome
---

## Εισαγωγή

Έχουμε ένα γράφο με μορφή πλέγματος (grid) και η κίνηση γίνεται οριζόντια και κάθετα στους διπλανούς κόμβους. Ενδέχεται να υπάρχουν απαγορευμένοι κόμβοι(κτίρια).
Στο γράφο αυτό κινούμαστε ταυτόχρονα με έναν αστυνομικό και θέλουμε να φτάσουμε στην έξοδο (σπίτι) χωρίς να καταφέρει ο αστυνομικός να μας δει. Δεν ξέρουμε ποια διαδρομή θα ακολουθήσει ο αστυνομικός και πρέπει να σχεδιάσουμε τη διαδρομή σύμφωνα με την πιο απαισιόδοξη για εμάς κίνηση του αστυνομικού.

## Λύση με απλή μέτρηση αποστάσεων (17% της βαθμολογίας)

Στο subtask αυτό δεν υπάρχουν εμπόδια.

**Παρατήρηση 1:** μας ενδιαφέρει μόνο αν ο αστυνομικός εποπτεύσει το σπίτι μας πριν φτάσουμε εμείς εκεί. Αρκεί δηλαδή να μετακινηθεί μόνο οριζόντια ή μόνο κάθετα ώστε να φτάσει στη γραμμή ή στήλη του σπιτιού. Στο παρακάτω σχήμα, από τις δύο πορτοκαλί θέσεις, θα διαλέξει αυτή με τη συντομότερη διαδρομή.

**Απόδειξη:** Έστω 
$$R_\mathit{home}$$ η γραμμή και $$C_\mathit{home}$$ η στήλη του σπιτιού. 
Έστω ότι ο αστυνομικός θα μπορέσει να μας δει καθώς περνάμε από τη στήλη[^1] $$C_\mathit{you}$$, 
πριν φτάσουμε στο σπίτι, την ώρα που θα βρισκόμαστε στο σημείο $$(R_\mathit{you},C_\mathit{you})$$.
Τότε για τον αστυνομικό, ο απαιτούμενος χρόνος να φτάσει από τη στήλη $$C_\mathit{you}$$ 
στη στήλη επόπτευσης του σπιτιού, είναι $$t_\mathit{pol} = |C_\mathit{home} - C_\mathit{you}|$$ 
ενώ για εμάς είναι $$t_\mathit{you} = |C_\mathit{home} - C_\mathit{you}| + |R_\mathit{home}-R_\mathit{you}| \Rightarrow t_\mathit{you} = t_\mathit{pol} + |R_\mathit{home}-R_\mathit{you}|$$.  
Ισχύει ότι $$|R_\mathit{home}-R_\mathit{you}| \ge 0$$, οπότε από την προηγούμενη ισότητα προκύπτει ότι $$t_\mathit{you} \ge t_\mathit{pol}$$. 

Άρα αν ο αστυνομικός μπορεί να μας δει σε οποιοδήποτε σημείο της διαδρομής μας, θα μας δει και την ώρα που φτάνουμε στο σπίτι. Οπότε για να λύσουμε το subtask αυτό, αρκεί να ελέγξουμε αν μπορούμε να φτάσουμε στο σπίτι πριν το εποπτεύσει ο αστυνομικός.

**Παρατήρηση 2:** Εμείς θα πρέπει να κινηθούμε όσο γρηγορότερα γίνεται για να φτάσουμε στο σπίτι. Άρα δεν συμφέρει να κάνουμε περιττά βήματα ώστε να αποφύγουμε τον αστυνομικό καθώς θα χάσουμε περισσότερο χρόνο και δεν θα μπορέσουμε να μπούμε με ασφάλεια στο σπίτι.

Η διαδρομή που θα κάνουμε εμείς, θα είναι μια ευθύγραμμη κίνηση (αν βρισκόμαστε στην ίδια γραμμή ή στήλη με το σπίτι) ή δυο ευθύγραμμες κινήσεις (μια οριζόντια και μια κατακόρυφη). Το άθροισμα της κατακόρυφης και οριζόντιας απόστασης που θα διανύσουμε, ονομάζεται απόσταση *Manhattan*. Για παράδειγμα, στο παρακάτω σχήμα χρειαζόμαστε 3 βήματα για να φτάσουμε σπίτι ενώ γιά τον αστυνομικό αρκεί 1 μόνο βήμα για να φτάσει στη γραμμή του σπιτιού και να μας περιμένει εκεί.

![Παράδειγμα](/assets/33-pdp-c-2-manhattan1.svg){:width="160px"}

Ο υπολογισμός της απάντησης γίνεται σε $$\mathcal{O}(1)$$ χρόνο. Η συνολική πολυπλοκότητα είναι $$\mathcal{O}(N\cdot M)$$ λόγω της ανάγνωσης των δεδομένων εισόδου. 

{% include code.md solution_name='wayhome_nobuildings.cc' %} 

## Λύση με διπλό bfs και ενημέρωση γραμμών/στηλών με βρόγχο (42% της βαθμολογίας)

Θα κάνουμε δυο διασχίσεις του γράφου, μια για τον αστυνομικό και μια για εμάς.
Στην πρώτη διάσχιση, ο αστυνομικός μπορεί να επισκεφτεί κάθε κελί ή να το εποπτεύσει από απόσταση αν οριζόντια ή κάθετα από τη θέση του δεν παρεμβάλλεται κτίριο.
Στόχος μας είναι να υπολογίσουμε τον ελάχιστο χρόνο που χρειάζεται ο αστυνομικός για να φτάσει σε κάθε κελί και τον ελάχιστο χρόνο για να εποπτεύσει το κάθε κελί.
Επόμενο βήμα είναι να προσπαθήσουμε να φτάσουμε από τη θέση που βρισκόμαστε εμείς, στο κελί τερματισμού, περνώντας από οποιαδήποτε κελιά απαιτείται, αρκεί να τα επισκεφτούμε πριν το χρόνο που ο αστυνομικός μπορεί να τα επισκεφτεί η τα εποπτεύσει.

Εφόσον έχει σημασία να μετράμε τα βήματα μας από την αρχική θέση, θα ακολουθήσουμε μέθοδο bfs (αναζήτηση κατά πλάτος) ώστε να εξερευνούμε πρώτα όλες τις κινήσεις μια τιμής χρόνου (βάθους) $$i$$ πριν πάμε στην επόμενη $$i+1$$.

Εκτελούμε ένα bfs για τον αστυνομικό και σε κάθε θέση που φτάνει, ενημερώνουμε τα κελιά της οριζόντιας και κατακόρυφης ακμής για το χρόνο επόπτευσης.
Το bfs έχει πολυπλοκότητα $$\mathcal{O}(N\cdot M)$$ και για κάθε ένα κελί που επισκεπτόμαστε, θα χρειαστούμε επιπλέον $$\mathcal{O}(N+M)$$ χρόνο για τις ενημερώσεις.
Συνολική πολυπλοκότητα $$\mathcal{O}(N\cdot M\cdot (N+M))$$

{% include code.md solution_name='wayhome_42.cc' %} 

## Λύση με απόδοση εκπροσώπων + bfs (100% της βαθμολογίας)

Στην προηγούμενη λύση για κάθε κελί που επισκεπτόταν ο αστυνομικός, 
ενημερώναμε τους χρόνους θέασης των κελιών της οριζόντιας και κατακόρυφης γραμμής και καταλήγαμε σε πολυπλοκότητα της τάξης $$\mathcal{O}(N^3)$$. 

**Παρατήρηση 2:** Ας θεωρήσουμε ότι σε οποιαδήποτε θέση $$x,y$$ έχουμε "δρόμο". Ας ορίσουμε την οριζόντια ομάδα που περιέχει τη θέση $$x,y$$, ως όλα τα συνεχόμενα κελιά, αριστερά και δεξιά της $$x,y$$ που δεν περιέχουν κτίριο.
Όλα τα κελιά της ομάδας αυτής, θα τα εποπτεύσει ταυτόχρονα ο αστυνομικός μόλις φτάσει σε οποιοδήποτε από αυτά και αρκεί σε κάθε ομάδα να έχουμε αποδώσει έναν εκπρόσωπο για να ενημερώνουμε σε χρόνο $$\mathcal{O}(1)$$ τη χρονική στιγμή που ο αστυνομικός θα τα εποπτεύσει. 

Μπορούμε να χρησιμοποιήσουμε μια παραλλαγή του αλγορίθμου flood fill[^2] για να αποδώσουμε εκπροσώπους στα κελιά. Κάνουμε ένα διπλό (nested) loop ώστε για κάθε κελί που δεν έχει εκπροσώπους, να του αποδώσουμε έναν νέο και ταυτόχρονα ενημερώνουμε όλα τα κελιά της ομάδας του ότι έχουν τον ίδιο εκπρόσωπο. Σε κάθε κελί που αποκτά εκπρόσωπο θα χρειαστεί να ενημερώσουμε έως $$N+M$$ ακόμα κελιά (τα συνευθειακά του οριζόντια ή κατακόρυφα). Σε κάθε κελί όμως θα αποδοθεί το πολύ μια φορά εκπρόσωπος άρα η απόδοση εκπροσώπων έχει amortized πολυπλοκότητα $$\mathcal{O}(N\cdot M)$$. Συνολική πολυπλοκότητα λύσης: $$\mathcal{O}(N\cdot M)$$. 

![Παράδειγμα](/assets/33-pdp-c-2-proxy1.svg){:width="400px"}

Η απόδοση εκπροσώπων γίνεται με τον παρακάτω κώδικα:

{% include code.md solution_name='wayhome_proxy.cc' start=75 end=106 %} 

Η bfs του αστυνομικού:

{% include code.md solution_name='wayhome_proxy.cc' start=59 end=72 %} 

Η bfs της δικιάς μας κίνησης:

{% include code.md solution_name='wayhome_proxy.cc' start=119 end=130 %} 
(δείτε όλον τον κώδικα [εδώ]({% include link_to_source.md solution_name='wayhome_proxy.cc' %}))


## Συμτομότερος κώδικας απόδοσης εκπροσώπων + bfs (100% της βαθμολογίας)

Για κάθε κελί ορίζουμε σαν εκπρόσωπο οριζόντιας επόπτευσης το αριστερότερο ορατό κελί και σας εκπρόσωπο κατακόρυφης επόπτευσης το υψηλότερο κατακόρυφο ορατό κελί. Η απόδοση εκπροσώπων για κάθε κελί γίνεται σε χρόνο $$\mathcal{O}(1)$$. Η συνολική πολυπλοκότητα της λύσης είναι: $$\mathcal{O}(N\cdot M)$$. 

{% include code.md solution_name='wayhome_proxy_fast.cc' start=96 end=115 %} 
(δείτε τον κώδικα [εδώ]({% include link_to_source.md solution_name='wayhome_proxy_fast.cc' %}))

[^1]: αντίστοιχη είναι η απόδειξη αν μας δει στη γραμμή $$R_\mathit{you}$$. 
[^2]: εναλλακτικά μπορούμε να χρησιμοποιήσουμε και τη δομή union-find για να αποδώσουμε εκπροσώπους. Σε κάθε κελί θα υπάρχει ο οριζόντιος και κατακόρυφος εκπρόσωπος. Καθώς ο αστυνομικός εξερευνεί κελιά, θα γίνεται και η συνένωση των κελιών σε ομάδες. Ο χρόνος επόπτευσης οποιαδήποτε οριζόντιας ή κατακόρυφης ομάδας, θα είναι ο μικρότερος χρόνος επίσκεψης σε οποιοδήποτε κελί της. 
